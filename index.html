<!DOCTYPE html>
<html>
  <head>
    <title>Stay off the red lines</title>
  </head>

  <body style="text-align: center; background-color: black;">
    <canvas id="screen" style="margin-top: 40px"></canvas>

    <script>
    window.performance&&window.performance.now?getTimestamp=function(){return window.performance.now()}:window.performance&&window.performance.webkitNow?getTimestamp=function(){return window.performance.webkitNow()}:getTimestamp=function(){return(new Date).getTime()};var t=new function(){var f=0,a=50,i=30,y=16,T=16,d=y*a,v=y*i,u=32,b=7,m=["#00aa00","#4444dd","#aaaa00","#aa00aa"],c=["#008800","#333388","#888800","#880088"],g=0,p=0,A=0,x=200,l=0,S=null,w=null,X=[],s=0,o=0,h=null,F=null,R=null,r=null,E=null,B=null,Y=null,I=[],C=[],Q=[],V=[],k=0,M=0,O=0,W=0,D=0,L=0,J=0,P=0,j=[],q=[],U=1,n=function(e,t,a,i,r,n,l,s,o){this.actorType=2,this.x=e*y,this.y=t*T,this.sX=.04*r,this.sY=.04*n,this.type=a,this.direction=i,this.flash=0,this.flashEmitterOn=1,this.flashEmitterLastTime=0,this.flashEmitterOnTime=1e3,this.flashEmitterOffTime=1e3,this.points=[],this.angle=0,this.width=void 0!==l?l:y,this.height=void 0!==s?s:T,this.minY=void 0!==o?o:-1},G=function(e,t,a,i){this.x=e,this.y=t,this.type=a,this.orientation=i,this.state=0},H=function(){this.actorType=0,this.x=0,this.y=0,this.state=0,this.stateTimer=0,this.height=32,this.width=32,this.sX=0,this.maxSX=1,this.lastDirection=0,this.lastAction=0,this.lastActionTime=0,this.sY=0,this.maxSY=1,this.jumpStartY=0,this.baseFrame=0,this.frameCount=0,this.currentFrame=0,this.frameTime=0,this.actionTime=0,this.gravityForce=0,this.hFriction=.2,this.hForce=1,this.canTriggerAction=1,this.dashSx=0,this.dashSy=0,this.canDash=0,this.dashCounter=0,this.canWallRun=1,this.inWallRun=0,this.wallRunTime=0,this.inJump=0,this.canJump=1,this.tileLeft=0,this.tileRight=0,this.tileBelow=0,this.tileAbove=0,this.touchingExit=0},K=function(){!function(){for(var e=0;e<i;e++){j[e]=[];for(var t=0;t<a;t++)j[e][t]=0==e||0==t||29==e||49==t?1:0}C=[],Q=[]}(),q=[],g=getTimestamp(),A=p=0,Y.state=1,Y.onEmitter=!1,Y.inDash=0,Y.inWallJump=0,Y.canDash=1,Y.sX=0,Y.sY=0,Y.canWallRun=1,Y.inWallRun=0,Y.wallRunTime=0,Y.uhOhCounter=0,k=0,f>=z.length&&(f=0),z[f](),playSound(1)},z=[];z[0]=function(){s=45,o=21,Y.x=32,Y.y=270;for(var e=0;e<i;e++)for(var t=0;t<a;t++)22!=e&&12!=e||(j[e][t]=1),((t+3)%5||t<5||44<t)&&16==e&&(j[e][t]=1);C.push(new n(7,14,2,2,1,0)),C.push(new n(14,14,2,2,1,0)),C.push(new n(21,14,2,2,1,0)),C.push(new n(28,14,2,2,-1,0)),C.push(new n(35,14,2,2,-1,0)),C.push(new n(42,14,2,2,-1,0))};z[1]=function(){s=45,o=5,Y.x=32,Y.y=240;for(var e=0;e<i;e++)for(var t=0;t<a;t++)(44<t&&t<49&&18==e||6==e&&5<t&&Math.floor((t-3)/3)%3)&&(j[e][t]=b),(t<13||36<t)&&t<42&&13==e&&(j[e][t]=1),((Math.floor((t+7)/3)%5||t<8||41<t)&&22==e||15==e&&t%2&&12<t&&t<37||6==e&&38<t)&&(j[e][t]=1);C.push(new n(1,23,2,0,0,0)),C.push(new n(48,23,2,4,0,0)),C.push(new n(23,13,2,2,1,0,4*y)),C.push(new n(12,14,2,0,0,0)),C.push(new n(37,14,2,4,0,0))},z[2]=function(){s=45,o=6,Y.x=32,Y.y=290;for(var e=0;e<i;e++)for(var t=0;t<a;t++)(22==e&&(t<12||19<t&&t<30||37<t)||18==e&&t<44&&(t<18||31<t)||11==e&&5<t||7==e&&1<t&&(t<11||31<t))&&(j[e][t]=1);C.push(new n(1,7,2,2,0,0)),C.push(new n(12,22,2,0,0,0)),C.push(new n(19,22,2,4,0,0)),C.push(new n(18,18,2,0,0,0)),C.push(new n(31,18,2,4,0,0)),C.push(new n(30,22,2,0,0,0)),C.push(new n(37,22,2,4,0,0)),C.push(new n(24,7,2,0,0,0,2)),C.push(new n(18,7,2,4,0,0,2))},z[3]=function(){k=0,s=45,o=6,Y.x=32,Y.y=410;for(var e=0;e<i;e++)for(var t=0;t<a;t++)(25==e&&30<t&&t<35||20==e&&20<t&&t<25||15==e&&10<t&&t<15||11==e&&21==t)&&(j[e][t]=3),(10==e&&20<t&&t<27||10==e&&36<t&&t<41)&&(j[e][t]=4),(7==e&&42<t&&t<49||21==e&&t<44&&36<t||16==e&&28<t&&t<34)&&(j[e][t]=6),20==e&&43<t&&t<49&&(j[e][t]=5),10==e&&0<t&&t<5&&(j[e][t]=1);Q.push(new G(9,28,3,0)),Q.push(new G(2,9,4,0)),Q.push(new G(38,9,5,0)),Q.push(new G(45,19,6,0)),C.push(new n(43,14,2,6,0,0)),C.push(new n(43,18,2,2,0,0)),C.push(new n(30,25,2,4,0,0)),C.push(new n(20,20,2,4,0,0)),C.push(new n(10,15,2,4,0,0)),C.push(new n(26,11,2,4,0,0))},z[4]=function(){k=4,s=45,o=6,Y.x=32,Y.y=390;for(var e=0;e<i;e++)for(var t=0;t<a;t++)(21==e&&t<43||42==t&&21<e&&e<25||12==t&&21<e&&e<25||44<t&&t<47&&17==e)&&(j[e][t]=1),(24==e&&t<42&&12<t||46<t&&17==e&&t<49)&&(j[e][t]=3),(14==e&&5<t&&t<49||6==t&&11<e&&e<15)&&(j[e][t]=4),(14==e&&5<t&&Math.floor((t-1)/6)%2||42==t&&11<e&&e<16)&&(j[e][t]=1),(7==e&&42<t&&t<49||6==e&&36==t)&&(j[e][t]=6),5==e&&0<t&&t<40&&(j[e][t]=5);Q.push(new G(9,28,3,0)),Q.push(new G(45,28,3,0)),Q.push(new G(9,20,4,0)),Q.push(new G(45,13,5,0)),Q.push(new G(3,4,6,0)),C.push(new n(15,22,2,2,1,0)),C.push(new n(40,22,2,2,-1,0)),C.push(new n(15,12,2,2,2,0)),C.push(new n(28,12,2,2,-2,0)),C.push(new n(20,12,2,0,-2,0)),C.push(new n(31,12,2,4,-2,0)),C.push(new n(40,12,2,2,-2,0)),C.push(new n(43,15,2,2,-2,0)),C.push(new n(40,6,2,4,0,0))},z[5]=function(){Y.x=32,Y.y=390,k=6,s=45,o=28;for(var e=0;e<i;e++)for(var t=0;t<a;t++)(23==e&&(t<22||27<t)||18==e&&3<t&&t<43||43==t&&3<e&&e<14||37==t&&5<e&&e<15&&13!=e||31==t&&3<e&&e<18&&6!=e||25==t&&0<e&&e<15&&13!=e)&&(j[e][t]=1),41==t&&23<e&&e<29&&(j[e][t]=6),(0<t&&t<25&&1==e||1==t&&1<e&&e<14||24==t&&1<e&&e<14)&&(j[e][t]=2),14==e&&0<t&&t<25&&(j[e][t]=6),18==e&&0<t&&t<4&&(j[e][t]=6);Q.push(new G(24,17,3,0)),C.push(new n(22,23,2,0,0,0)),C[C.length-1].flash=1,C.push(new n(27,23,2,0,0,0)),C[C.length-1].flash=1,C.push(new n(43,18,2,6,0,0)),C.push(new n(37,5,2,6,0,0)),C.push(new n(31,6,2,0,0,0)),C[C.length-1].flash=1,C.push(new n(37,13,2,4,0,0)),C[C.length-1].flash=1,C.push(new n(25,13,2,0,0,0)),C[C.length-1].flash=1,C.push(new n(12,8,1,1.5,0,0)),C[C.length-1].flash=1},z[6]=function(){Y.x=32,Y.y=390,s=45,o=6;for(var e=k=0;e<i;e++)for(var t=0;t<a;t++)(11==e&&t<11||e<12&&11==t||7==e&&42<t||27==e&&t<5)&&(j[e][t]=1),(8==e&&40<t&&t<49||18==e&&0<t&&t<5||36<t&&t<43&&21==e)&&(j[e][t]=6),(8<t&&t<15&&22==e||36<t&&t<43&&25==e||36<t&&t<43&&9==e)&&(j[e][t]=3),(8<t&&t<15&&18==e||18==t&&5==e||36<t&&t<43&&17==e)&&(j[e][t]=5),(20<t&&t<29&&23==e||36<t&&t<43&&13==e||31==t&&5==e)&&(j[e][t]=4);Q.push(new G(5,10,3,0)),Q.push(new G(10,5,4,2)),Q.push(new G(5,1,5,3)),Q.push(new G(1,5,6,1)),C.push(new n(5.5,5.5,1,12,0,0)),C.push(new n(1,29,2,0,0,0)),C.push(new n(18,1,2,2,0,0)),C.push(new n(31,1,2,2,0,0))},z[7]=function(){k=6,Y.x=32,Y.y=390,s=4,o=22;for(var e=0;e<i;e++)for(var t=0;t<a;t++)(23==e&&t%2&&t<47||12==e&&!((t+1)%3))&&0<t&&t<49&&(j[e][t]=2),23==e&&t<10&&(j[e][t]=1),(0<t&&t<10&&24==e||9==t&&13<e&&24<e&&e<29)&&(j[e][t]=6);Q.push(new G(6,28,3,0)),C.push(new n(5,4,2,3,1,0)),C.push(new n(28,6,2,1,-1,0)),C.push(new n(10,8,2,1,-1,0)),C.push(new n(18,10,2,3,1,0))},z[8]=function(){k=6,Y.x=32,Y.y=390,s=45,o=5;for(var e=0;e<i;e++)for(var t=0;t<a;t++)6==e&&42<t&&(j[e][t]=1),(21==e&&30<t&&t<49||14==e&&8<t&&t<24||7==e&&30<t&&t<49)&&(j[e][t]=b);C.push(new n(1,8,2,0,0,0)),C[C.length-1].flash=1,C[C.length-1].flashEmitterOnTime=400,C[C.length-1].flashEmitterOffTime=400,C.push(new n(49,15,2,4,0,0)),C[C.length-1].flash=1,C[C.length-1].flashEmitterOnTime=800,C[C.length-1].flashEmitterOffTime=800,C.push(new n(1,22,2,0,0,0)),C[C.length-1].flash=1,C[C.length-1].flashEmitterOnTime=1e3,C[C.length-1].flashEmitterOffTime=1e3,C.push(new n(42,1,2,2,0,0)),C[C.length-1].flash=1,C[C.length-1].flashEmitterOnTime=300,C[C.length-1].flashEmitterOffTime=300},z[9]=function(){k=6,Y.x=32,Y.y=390,s=45,o=5;for(var e=0;e<i;e++)for(var t=0;t<a;t++)6==e&&42<t&&(j[e][t]=1),6==e&&0<t&&t<5&&(j[e][t]=3),(8==e&&22<t&&t<49||22==e&&22<t&&t<49||9==t&&0<e&&e<20)&&(j[e][t]=2),(35<t&&20==e&&t<49||9<t&&t<14&&15==e)&&(j[e][t]=5),(0<t&&t<10&&24==e||9==t&&13<e&&24<e&&e<29||9<t&&t<23&&8==e)&&(j[e][t]=6);Q.push(new G(6,28,3,0)),Q.push(new G(46,21,6,0)),Q.push(new G(2,5,5,0)),Q.push(new G(45,28,4,0)),C.push(new n(24,15,1,-1,0,0)),C[C.length-1].flash=1,C[C.length-1].flashEmitterOnTime=400,C[C.length-1].flashEmitterOffTime=400,C.push(new n(15,5,1,1,0,0)),C[C.length-1].flash=1,C[C.length-1].flashEmitterOnTime=400,C[C.length-1].flashEmitterOffTime=400},z[10]=function(){k=4,s=45,o=5;for(var e=0;e<i;e++)for(var t=0;t<a;t++)6==e&&42<t&&(j[e][t]=1);Y.x=32,Y.y=390,C.push(new n(5,28,2,2,1,1,3*y,T,80)),C.push(new n(9,28,2,2,-1,1,3*y,T,80))};var N=function(e){switch(null==B&&initSound(),e.keyCode){case 37:O=1,e.preventDefault();break;case 39:W=1,e.preventDefault();break;case 38:D=1,e.preventDefault();break;case 40:L=1,e.preventDefault();break;case 90:case 67:J=1,e.preventDefault();break;case 88:P=1,e.preventDefault()}},Z=function(e){switch(e.keyCode){case 37:O=0;break;case 39:W=0;break;case 38:D=0;break;case 40:L=0;break;case 90:case 67:J=0;break;case 88:P=0}},$=function(e,t){if(0==Y.state){if(Y.stateTimer+=t,!(500<Y.stateTimer))return;K()}if(2==Y.state){if(Y.stateTimer+=t,!(600<Y.stateTimer))return;f++,K()}var a=4*y+y/2,i=Y.baseFrame+Y.currentFrame;i<X.length&&(Y.bounds=X[i],ee(Y,!0),ee(Y,!0));var r=0,n=0;if(Y.onEmitter=!1,50<=Y.tileBelow&&Y.tileBelow<100){var l=Y.tileBelow-50;if((Y.onEmitter=l)<C.length){var s=C[l];Y.y>s.y-u+Y.bounds[1]&&(Y.y=s.y-u+Y.bounds[1]),r=s.sX,0<s.sY&&(n=s.sY)}}Y.maxSX=.28;var o=Y.lastAction;if(L&&Y.touchingExit)return playSound(10),Y.state=2,void(Y.stateTimer=0);Y.inDash||Y.inWallJump||(Y.tileBelow?(0<Y.sY&&(Y.sY=0),Y.hFriction=.005,Y.hForce=.003,Y.canDash=1,Y.dashCounter=0,Y.canWallRun=1,Y.wallRunTime=0,Y.inWallJump=0):(Y.gravityForce=.0025,Y.maxSY=.3,9==Y.lastAction?0<=Y.lastDirection?Y.baseFrame=3:Y.baseFrame=14:(0<=Y.lastDirection?Y.baseFrame=5:Y.baseFrame=16,o=10),Y.frameCount=1,0<Y.sY&&(Y.tileLeft?(o=8,Y.baseFrame=17,Y.frameCount=1,Y.gravityForce=.001,Y.maxSY=.2):Y.tileRight&&(o=7,Y.baseFrame=6,Y.frameCount=1,Y.gravityForce=.001,Y.maxSY=.2)),Y.sY+=Y.gravityForce*t,Y.sY>Y.maxSY&&(Y.sY=Y.maxSY),Y.hFriction=.001,Y.hForce=.0027)),Y.tileBelow&&(Y.wallRunTime=0,Y.inWallJump=0,Y.canWallRun=1),O||W||Y.inDash||Y.inWallJump||(Y.tileBelow||(5==Y.lastAction&&(Y.x+=2),6==Y.lastAction&&(Y.x-=2)),0<Y.sX&&(Y.sX-=Y.hFriction*t,Y.sX<0&&(Y.sX=0)),Y.sX<0&&(Y.sX+=Y.hFriction*t,0<Y.sX&&(Y.sX=0)),Y.tileBelow&&(o=1,0<=Y.lastDirection?1!=Y.baseFrame&&(Y.baseFrame=0,Y.frameCount=1):12!=Y.baseFrame&&(Y.baseFrame=11,Y.frameCount=1))),P?Y.canTriggerAction&&(Y.canTriggerAction=0,Y.canDash&&(playSound(4),Y.canDash=0,Y.inDash=1,V=[],Y.dashSy=0,Y.dashSx=0,Y.frameCount=1,D?(Y.tileAbove||(Y.sY=-.9,Y.baseFrame=21),O&&(Y.sX=-.9,Y.baseFrame=20),W&&(Y.sX=.9,Y.baseFrame=9)):O?(Y.sX=-.9,Y.sY=0,Y.baseFrame=19):W?(Y.sX=.9,Y.sY=0,Y.baseFrame=8):Y.lastDirection<0?(Y.sX=-.9,Y.sY=0,Y.baseFrame=19):(Y.sX=.9,Y.sY=0,Y.baseFrame=8),Y.dashStartX=Y.x,Y.dashStartY=Y.y,console.log("action key!"))):Y.canTriggerAction=!0,!O||Y.inDash||Y.inWallJump||(!Y.tileBelow&&Y.tileLeft?Y.sY<0&&Y.canWallRun?(Y.sY=-.3*(600-Y.wallRunTime)/600,Y.inWallRun=1,o=6,Y.baseFrame=35,Y.frameCount=3):(o=8,Y.baseFrame=17,Y.frameCount=1,Y.inWallRun=0):(Y.sX-=Y.hForce*t,Y.sX<-Y.maxSX&&(Y.sX=-Y.maxSX),Y.tileBelow&&(o=4,Y.baseFrame=13,Y.frameCount=3))),!W||Y.inDash||Y.inWallJump||(!Y.tileBelow&&Y.tileRight?Y.sY<0&&Y.canWallRun?(Y.sY=-.3*(600-Y.wallRunTime)/600,Y.inWallRun=1,o=5,Y.baseFrame=24,Y.frameCount=3):(o=7,Y.baseFrame=6,Y.frameCount=1,Y.inWallRun=0):(Y.sX+=Y.hForce*t,Y.sX>Y.maxSX&&(Y.sX=Y.maxSX),Y.tileBelow&&(o=3,Y.baseFrame=2,Y.frameCount=3))),Y.inWallJump||Y.inDash||(J?Y.tileAbove?Y.inJump&&(Y.inJump=!1,o=10):Y.inJump?(Y.sY=-.35,Y.y+Y.sY*t<Y.jumpStartY-88&&(Y.sY=0,Y.y=Y.jumpStartY-88,Y.inJump=!1),o=9,0<=Y.lastDirection?Y.baseFrame=3:Y.baseFrame=14,Y.frameCount=1):Y.canJump&&(Y.tileBelow?(playSound(3),Y.inJump=1,Y.canJump=0,Y.sY=-.35,Y.jumpStartY=Y.y,o=-9,0<=Y.lastDirection?Y.baseFrame=3:Y.baseFrame=14,Y.frameCount=1):Y.tileRight?(playSound(3),Y.inJump=1,Y.inWallJump=1,Y.canJump=0,Y.sY=-.35,Y.sX=-.38,Y.jumpStartY=Y.y,Y.dashStartX=Y.x,Y.dashStartY=Y.y,Y.baseFrame=14,Y.frameCount=1):Y.tileLeft&&(console.log("wall jump!"),Y.inJump=1,playSound(3),Y.inWallJump=1,Y.canJump=0,Y.sY=-.35,Y.sX=.38,Y.jumpStartY=Y.y,Y.dashStartX=Y.x,Y.dashStartY=Y.y,Y.baseFrame=3,Y.frameCount=1)):(Y.inJump=0,Y.canJump=1)),Y.tileBelow||Y.inDash||Y.inWallJump||(9==Y.lastAction||9==o?0<Y.sX?(Y.baseFrame=3,Y.frameCount=1):Y.sX<0&&(Y.baseFrame=14,Y.frameCount=1):0<Y.sX?(Y.baseFrame=5,Y.frameCount=1):Y.sX<0&&(Y.baseFrame=16,Y.frameCount=1)),0!=Y.sX&&(Y.lastDirection=Y.sX),(Y.tileLeft&&Y.sX<0||Y.tileRight&&0<Y.sX)&&(Y.sX=0,Y.inDash=0,Y.inWallJump=0),Y.tileAbove&&Y.sY<0&&(Y.sY=0,Y.inDash=0,Y.inWallJump=0),Y.x+=(Y.sX+r)*t,Y.y+=(Y.sY+n)*t,Y.inWallRun&&(Y.wallRunTime+=t,600<Y.wallRunTime&&(Y.canWallRun=!1));var h=128;Y.inWallJump&&(h=a),(Y.inDash||Y.inWallJump)&&(V.push([Y.x,Y.y]),Y.dashStartX>Y.x&&h<Y.dashStartX-Y.x&&(Y.inDash=0,Y.inWallJump=0,Y.x=Y.dashStartX-h,Y.sX<0&&(Y.sX=-Y.maxSX)),Y.dashStartX<Y.x&&h<Y.x-Y.dashStartX&&(Y.inDash=0,Y.inWallJump=0,Y.x=Y.dashStartX+h,0<Y.sX&&(Y.sX=Y.maxSX)),Y.dashStartY>Y.y&&h<Y.dashStartY-Y.y&&(Y.inDash=0,Y.inWallJump=0,Y.y=Y.dashStartY-h,Y.sY<0&&(Y.sY=-Y.maxSY)),Y.dashStartY<Y.y&&h<Y.y-Y.dashStartY&&(Y.inDash=0,Y.inWallJump=0,Y.y=Y.dashStartX+h,0<Y.sY&&(Y.sY=Y.maxSY))),o!=Y.lastAction?(Y.frameTime=0,Y.currentFrame=0,Y.lastAction=o,Y.lastActionTime=e):(Y.lastActionTime,1==o&&(3e3<e-Y.lastActionTime&&(11==Y.baseFrame?.3<Math.random()&&(Y.baseFrame=12):0==Y.baseFrame&&.3<Math.random()&&(Y.baseFrame=1),Y.lastActionTime=e),280<e-Y.lastActionTime&&(12==Y.baseFrame?(Y.lastActionTime=e,Y.baseFrame=11):1==Y.baseFrame&&(Y.lastActionTime=e,Y.baseFrame=0)))),Y.frameTime+=t,25<Y.frameTime&&(Y.frameTime=0,Y.currentFrame++,Y.currentFrame>=Y.frameCount&&(Y.currentFrame=0)),(i=Y.baseFrame+Y.currentFrame)<X.length&&(Y.bounds=X[i],ee(Y,!1),ee(Y,!1)),Y.tileAbove&&Y.tileBelow&&(Y.tileLeft||Y.tileRight)?(Y.uhOhCounter++,10<Y.uhOhCounter&&(Y.state=0,Y.stateTimer=0,playSound(2))):Y.uhOhCounter=0},_=(b=7,function(e,t){for(var a=0;a<q.length;a++)if(q[a][0]===e&&q[a][1]==t)return;var i=getTimestamp();q.push([e,t,i]),j[t][e]=8}),ee=function(e){var t=e.bounds,a=Math.floor(e.x)+t[0],i=Math.floor(e.x)+t[2],r=Math.floor(e.y)+t[1],n=Math.floor(e.y)+t[3];e.tileAbove=0,e.tileBelow=0,e.tileLeft=0;var l,s=e.tileRight=0,o=0;if((o=r-1)<0)e.tileAbove=1;else for(s=a+1;s<i;s++)if(0<(f=S[o*d+s])&&(f<10||50<=f&&f<x&&2!=e.actorType)){e.tileAbove=f;break}if(e.tileAbove){var h=!1;for(o=r;o<n;o++){for(s=a+1;s<i;s++){var f;if(h=!0,0<(f=S[o*d+s])&&(f<10||50<=f&&f<x&&2!=e.actorType)){h=!1;break}}if(h){e.y+t[1]<o&&(e.y=o-t[1]);break}}}if(v<=(o=n+1))e.tileBelow=1;else for(s=a+1;s<i;s++)if(0<(p=S[o*d+s])&&(p<30||50<=p&&p<x&&2!=e.actorType)){if((e.tileBelow=p)==b){var u=Math.floor(s/y),m=Math.floor(o/T);!1===u&&!1===m||_(u,m)}if(10<e.tileBelow&&e.tileBelow<30){var c=Math.floor(s/y),g=Math.floor(o/T);0<c&&c<49&&0<g&&g<29&&(0<S[(g+1)*T*d+c*y]?k!=e.tileBelow-10&&(l=e.tileBelow-10,k!=l&&(k=l,playSound(k-3+6))):e.tileBelow=0)}}if(e.tileBelow)for(h=!1,o=n;r<o;o--){for(s=a+1;s<i;s++){var p;if(h=!0,0<(p=S[o*d+s])&&(p<30||50<=p&&p<x&&2!=e.actorType)){h=!1;break}}if(h){e.y+t[3]>o&&(e.y=o-t[3]);break}}if(r=Math.floor(e.y)+t[1],n=Math.floor(e.y)+t[3],(s=a-1)<0)e.tileLeft=1;else for(o=r+1;o<n;o++)if(0<(A=S[o*d+s])&&(A<10||50<=A&&A<x&&2!=e.actorType)){e.tileLeft=A;break}if(e.tileLeft)for(h=!1,s=a;s<i;s++){for(o=r+1;o<n;o++){var A;if(h=!0,0<(A=S[o*d+s])&&(A<10||50<=A&&A<x&&2!=e.actorType)){h=!1;break}}if(h){e.x+t[0]<s&&(e.x=s-t[0]);break}}if(d<=(s=i+1))e.tileRight=1;else for(o=r+1;o<n;o++)if(0<(w=S[o*d+s])&&(w<10||50<=w&&w<x&&2!=e.actorType)){e.tileRight=w;break}if(e.tileRight)for(h=!1,s=i;a<s;s--){for(o=r+1;o<n;o++){var w;if(h=!0,0<(w=S[o*d+s])&&(w<10||50<=w&&w<x&&2!=e.actorType)){h=!1;break}}if(h){e.x+t[2]>s&&(e.x=s-t[2]);break}}},te=function(e,t,a,i,r,n){for(var l=0;l<u;l++)for(var s=0,o=0;o<u;o++){var h=4*(t+o+e.width*(a+l));1==n&&(s=i+u-1-o+e.width*(r+l)),2==n&&(s=i+o+e.width*(r+u-1-l)),3==n&&(s=i+l+e.width*(r+u-1-o)),s*=4;for(var f=0;f<4;f++)e.data[s+f]=e.data[h+f]}},ae=function(e,t,a){for(var i=u,r=0,n=u,l=0,s=0;s<u;s++)for(var o=0;o<u;o++){var h=4*(t+o+e.width*(a+s));0<e.data[h+3]&&(r<o&&(r=o),l<s&&(l=s),o<i&&(i=o),s<n&&(n=s))}return[i,n,r,l]};midiToFreq=function(e){return 440*Math.pow(2,(e-69)/12)};var ie=[],re=0,ne=[];createPinkNoise=function(){var e,t,a,i,r,n,l;e=t=a=i=r=n=l=0;for(var s=0;s<re;s++){var o=2*Math.random()-1;e=.99886*e+.0555179*o,t=.99332*t+.0750759*o,a=.969*a+.153852*o,i=.8665*i+.3104856*o,r=.55*r+.5329522*o,n=-.7616*n-.016898*o,ne[s]=e+t+a+i+r+n+l+.5362*o,ne[s]*=.11,l=.115926*o}};createNoiseBuffer=function(){for(var e=2*B.sampleRate,t=(ie=B.createBuffer(1,e,B.sampleRate)).getChannelData(0),a=0;a<e;a++)t[a]=2*Math.random()-1},initSound=function(){B=new AudioContext,re=20*B.sampleRate,createPinkNoise(),createNoiseBuffer()},playSound=function(e){if(null!=B){var t=B.currentTime,a=1/16,i=a,r=B.createGain(),n=null,l=null;switch(4!=e?((n=B.createOscillator()).type="square",n.connect(r)):(n=B.createBufferSource(),(l=B.createBiquadFilter()).connect(r),n.connect(l)),r.connect(B.destination),e){case 1:a=1/16,n.type="triangle",n.frequency.setValueAtTime(midiToFreq(55),t),n.frequency.setValueAtTime(midiToFreq(59),t+a),n.frequency.setValueAtTime(midiToFreq(62),t+2*a),r.gain.setValueAtTime(0,t),r.gain.linearRampToValueAtTime(.3,B.currentTime+1/64),r.gain.linearRampToValueAtTime(0,B.currentTime+3*a),i=4*a;break;case 2:a=1/12,n.type="sawtooth",n.frequency.setValueAtTime(midiToFreq(56),t),n.frequency.linearRampToValueAtTime(midiToFreq(49),t+a),r.gain.setValueAtTime(0,t),r.gain.linearRampToValueAtTime(.03,B.currentTime+a),r.gain.linearRampToValueAtTime(0,B.currentTime+2*a),i=2*a;break;case 3:a=1/12,n.type="triangle",n.frequency.setValueAtTime(midiToFreq(55),t),n.frequency.setValueAtTime(midiToFreq(62),t+a),r.gain.setValueAtTime(0,t),r.gain.linearRampToValueAtTime(.2,B.currentTime+1/64),r.gain.linearRampToValueAtTime(0,B.currentTime+2*a),i=2*a;break;case 4:n.buffer=ie,l.type="lowpass",l.frequency.setValueAtTime(440,t),l.frequency.linearRampToValueAtTime(440,t+2*a),r.gain.linearRampToValueAtTime(1,B.currentTime+1/64),r.gain.linearRampToValueAtTime(0,B.currentTime+2*a),i=2*a;break;case 5:break;case 6:a=.25,n.type="triangle",n.frequency.setValueAtTime(midiToFreq(43),t),r.gain.setValueAtTime(0,t),r.gain.linearRampToValueAtTime(.2,B.currentTime+1/32),r.gain.linearRampToValueAtTime(0,B.currentTime+a),i=a;break;case 7:a=.25,n.type="triangle",n.frequency.setValueAtTime(midiToFreq(47),t),r.gain.setValueAtTime(0,t),r.gain.linearRampToValueAtTime(.2,B.currentTime+1/32),r.gain.linearRampToValueAtTime(0,B.currentTime+a),i=a;break;case 8:a=.25,n.type="triangle",n.frequency.setValueAtTime(midiToFreq(50),t),r.gain.setValueAtTime(0,t),r.gain.linearRampToValueAtTime(.2,B.currentTime+1/32),r.gain.linearRampToValueAtTime(0,B.currentTime+a),i=a;break;case 9:a=.25,n.type="triangle",n.frequency.setValueAtTime(midiToFreq(54),t),r.gain.setValueAtTime(0,t),r.gain.linearRampToValueAtTime(.2,B.currentTime+1/32),r.gain.linearRampToValueAtTime(0,B.currentTime+a),i=a;break;case 10:a=1/12,n.type="triangle",n.frequency.setValueAtTime(midiToFreq(55),t),n.frequency.setValueAtTime(midiToFreq(62),t+a),n.frequency.setValueAtTime(midiToFreq(67),t+2*a),r.gain.setValueAtTime(0,t),r.gain.linearRampToValueAtTime(.3,B.currentTime+1/64),r.gain.linearRampToValueAtTime(0,B.currentTime+6*a),i=6*a}n.start(B.currentTime),n.stop(B.currentTime+i)}},this.init=function(){var e=document;e.onkeydown=N,e.onkeyup=Z,h=e.getElementById("screen"),U=1,h.style.width=d+"px",h.style.height=v+"px",h.width=d*U,h.height=v*U,F=h.getContext("2d"),S=new Uint8Array(d*v),E=e.createElement("canvas"),function(){E.height=T,E.width=40*y;for(var e=E.getContext("2d"),t=0;t<T;t++)for(var a=0;a<y;a++){var i=b*y+a;e.fillStyle="#aaaaaa",(Math.floor(a/2)+Math.floor(t/2))%2&&e.fillRect(i,t,1,1),i=8*y+a,(Math.floor(a/4)+Math.floor(t/4))%2&&e.fillRect(i,t,1,1)}for(var r=0;r<m.length;r++){var n=r+3;e.fillStyle=m[r],e.fillRect(n*y,0,y,T),e.beginPath(),e.lineWidth=1,e.setLineDash([2,2]),e.strokeStyle=c[r],e.rect(n*y+.5,.5,y-1,15),e.stroke(),n=r+3+20,e.beginPath(),e.lineWidth=1,e.setLineDash([2,2]),e.strokeStyle=c[r],e.rect(n*y+.5,.5,y-1,15),e.stroke()}e.setLineDash([])}(),(R=e.createElement("canvas")).width=3200,R.height=100,r=R.getContext("2d");var t=new Image;t.onload=function(){r.drawImage(t,0,0),function(){w=r.getImageData(0,0,R.width,R.height);var e=11,t=e*u,a=0;for(a=0;a<11;a++)te(w,a*u,0,t,0,1),t+=u,e++;for(a=0;a<11;a++)te(w,a*u,0,t,0,3),t+=u,e++;for(a=0;a<11;a++)te(w,a*u+704,0,t,0,1),t+=u,e++;for(a=0;a<22;a++)te(w,a*u,0,t,0,2),t+=u,e++;for(a=0;a<e;a++)X[a]=ae(w,a*u,0);for(a=0;a<w.data.length;a+=4)0==w.data[a]&&0==w.data[a+1]&&0==w.data[a+2]&&(w.data[a+3]=0);r.putImageData(w,0,0)}(),M=getTimestamp(),f=0,l=1,(Y=new H).actorType=1,I.push(Y),K()},t.src="data:image/png;base64,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"};var le=function(e){for(var t=0;t<C.length;t++){var a=C[t];if(1==a.type?a.angle+=e*a.direction/6e3:2==a.type&&(a.angle=Math.PI/4*a.direction),a.bounds=[0,0,a.width,a.height],0!=a.sX||0!=a.sY){a.x+=a.sX*e,a.y+=a.sY*e;var i=a.x,r=a.y;if(ee(a),0==a.sX&&(a.x=i),0==a.sY&&(a.y=r),a.y<a.minY)a.sY=-a.sY;else if(0<a.sX&&0<a.tileRight&&a.tileRight<20||a.sX<0&&0<a.tileLeft&&a.tileLeft<20)a.sX=-a.sX;else if(0<a.sY&&0<a.tileBelow&&a.tileBelow<20||a.sY<0&&0<a.tileAbove&&a.tileAbove<20)a.sY=-a.sY;else for(var n=0;n<C.length;n++)t!=n&&(0<a.sX?a.x+a.width>=C[n].x&&a.x<C[n].x&&(a.y>=C[n].y&&a.y<=C[n].y+C[n].height||a.y+a.height>=C[n].y&&a.y+a.height<=C[n].y+C[n].height)&&(a.sX=-a.sX):a.sX<0&&a.x<=C[n].x+C[n].width&&a.x+a.width>C[n].x+C[n].width&&(a.y>=C[n].y&&a.y<=C[n].y+C[n].height||a.y+a.height>=C[n].y&&a.y+a.height<=C[n].y+C[n].height)&&(a.sX=-a.sX),0<a.sY?a.y+a.height>=C[n].y&&a.y<C[n].y&&(a.x>=C[n].x&&a.x<=C[n].x+C[n].width||a.x+a.width>=C[n].x&&a.x+a.width<=C[n].x+C[n].width)&&(a.sY=-a.sY):a.sY<0&&a.y<=C[n].y+C[n].height&&a.y+a.height>C[n].y+C[n].height&&(a.x>=C[n].x&&a.x<=C[n].x+C[n].width||a.x+a.width>=C[n].x&&a.x+a.width<=C[n].x+C[n].width)&&(a.sY=-a.sY))}if(a.y<T&&(a.y=18),a.y+a.height>v-T&&(a.y=v-T-a.height),a.x<y&&(a.x=y=2),a.x+a.width>d-y&&(a.x=d-y-a.width),a.points=[],1e3!=k){var l=a.x+a.width/2,s=a.y+a.height/2;a.points.push([l,s]);for(var o=a.angle,h=se(l,s,o,a),f=0;!1!==h&&(a.points.push(h),2==h[2]?(o=h[3]?-o:-o+Math.PI,h=se(h[0],h[1],o,a)):h=!1,!(30<++f)););}}},se=function(e,t,a,i){for(var r=Math.cos(a),n=Math.sin(a),l=e+y*r*1.5,s=t+y*n*1.5,o=l,h=s,f=0;f<1e3;){if(l=Math.floor(e+r*f+y*r),s=Math.floor(t+n*f+y*n),l<0||d<=l||s<0||v<=s)return[l,s,1,0,0];var u=S[s*d+l];if(10<u&&u<20&&(k=u-10),0<u&&(u<10||50<=u&&u<x)){var m=0,c=0;return 0<r&&0<l&&2==S[s*d+l-1]&&(m=1),r<0&&l<d-1&&2==S[s*d+l+1]&&(m=1),0<n&&0<s&&2==S[(s-1)*d+l]&&(c=1),n<0&&s<v-1&&2==S[(s+1)*d+l]&&(c=1),[o,h,u,m,c]}o=l,h=s,i.flash&&!i.flashEmitterOn||(S[s*d+l]=x),f++}},oe=function(){F.lineWidth=2,F.strokeStyle="#ff0000",F.beginPath();for(var e=!1,t=0;t<C.length;t++)if((i=C[t]).flash&&(e=!0),(i.flashEmitterOn||!i.flash)&&0<i.points.length){F.moveTo(i.points[0][0],i.points[0][1]);for(var a=1;a<i.points.length;a++)F.lineTo(i.points[a][0],i.points[a][1])}if(F.stroke(),e){for(F.lineWidth=2,F.setLineDash([4,4]),F.strokeStyle="#777777",F.beginPath(),t=0;t<C.length;t++){var i;if(!(i=C[t]).flashEmitterOn&&i.flash&&0<i.points.length)for(F.moveTo(i.points[0][0],i.points[0][1]),a=1;a<i.points.length;a++)F.lineTo(i.points[a][0],i.points[a][1])}F.stroke(),F.setLineDash([])}},he=function(e){for(var t=0;t<j.length;t++)for(var a=0;a<j[0].length;a++){var i=j[t][a],r=1;if(e||(1==i&&(F.fillStyle="#0c0c0c",F.fillRect(a*y,t*T,y,T)),2==i&&(F.fillStyle="#aaaaaa",F.fillRect(a*y,t*T,y,T)),i==b&&F.drawImage(E,b*y,0,y,T,a*y,t*T,y,T),8==i&&F.drawImage(E,8*y,0,y,T,a*y,t*T,y,T)),3<=i&&i<=6&&k!=i&&(r=0),e||3<=i&&i<=6&&(k==i?(F.fillStyle=m[i-3],F.fillRect(a*y,t*T,y,T)):F.drawImage(E,(i+20)*y,0,y,T,a*y,t*T,y,T)),e){r||(i=0);for(var n=t*T*d+a*y,l=0;l<T;l++)for(var s=0;s<y;s++)S[n+l*d+s]=i}}F.setLineDash([])};this.update=function(){var e=getTimestamp(),t=(e-M)/1;if(M=e,l){F.fillStyle="#2b2b2b",F.fillRect(0,0,h.width,h.height);for(var a=0;a<C.length;a++)(i=C[a]).flash&&(i.flashEmitterOn&&e-i.flashEmitterLastTime>i.flashEmitterOnTime&&(i.flashEmitterOn=0,i.flashEmitterLastTime=e),!i.flashEmitterOn&&e-i.flashEmitterLastTime>i.flashEmitterOffTime&&(i.flashEmitterOn=1,i.flashEmitterLastTime=e));if(he(!0),0==f?function(e){var t=[[32,34,11,7],[50,34,42,7],[98,34,17,7],[122,34,23,7],[153,34,22,7],[182,34,17,7],[206,34,17,7],[230,34,17,7],[254,34,29,7]],a=[[32,46,83,7]];800<e-g&&(g=e,p=(p+1)%t.length,A=(A+1)%a.length),F.imageSmoothingEnabled=!1;var i=t[p][0],r=t[p][1],n=t[p][2],l=t[p][3],s=48,o=16*n,h=16*l,f=Math.floor((d-o)/2);F.drawImage(R,i,r,n,l,f,s,o,h),i=a[A][0],r=a[A][1],n=a[A][2],l=a[A][3],o=8*n,s=v-32-4-(h=8*l),f=Math.floor((d-o)/2),F.globalAlpha=.5,F.drawImage(R,i,r,n,l,f,s,o,h),F.globalAlpha=1,F.imageSmoothingEnabled=!0}(e):1==f?function(e){var t=[[122,46,53,7]];Y.y<180&&Y.x<180&&(t=[[290,34,53,7]]),800<e-g&&(g=e,p=(p+1)%t.length),F.imageSmoothingEnabled=!1;var a=t[p][0],i=t[p][1],r=t[p][2],n=t[p][3],l=8*r,s=8*n,o=v-32-4-s,h=Math.floor((d-l)/2);F.globalAlpha=.5,F.drawImage(R,a,i,r,n,h,o,l,s),F.globalAlpha=1,F.imageSmoothingEnabled=!0}(e):2==f?function(e){var t=[[182,46,54,7]];800<e-g&&(g=e,p=(p+1)%t.length),F.imageSmoothingEnabled=!1;var a=t[p][0],i=t[p][1],r=t[p][2],n=t[p][3],l=8*r,s=8*n,o=v-32-4-s,h=Math.floor((d-l)/2);F.globalAlpha=.5,F.drawImage(R,a,i,r,n,h,o,l,s),F.globalAlpha=1,F.imageSmoothingEnabled=!0}(e):f==z.length-1&&function(e){var t=[[242,46,23,7],[272,46,27,7]];800<e-g&&(g=e,p=(p+1)%t.length),F.imageSmoothingEnabled=!1;var a=t[p][0],i=t[p][1],r=t[p][2],n=t[p][3],l=26*r,s=26*n,o=Math.floor((d-l)/2);F.globalAlpha=.5,F.drawImage(R,a,i,r,n,o,160,l,s),F.imageSmoothingEnabled=!0,F.globalAlpha=1}(e),function(){var e=s*y,t=o*T+T,a=2*y;F.fillStyle="#cccccc",F.fillRect(e-3,t-45-3,a+6,48),F.fillStyle="#222222",F.fillRect(e+1,t-45+1,a-2,44),F.fillStyle="#efefef",F.fillRect(e+7-3,t-45-16-1-1,25,13),Y.touchingExit?F.fillStyle="#00ff00":F.fillStyle="#009900",F.fillRect(e+7-2,t-45-16-1,23,11),F.drawImage(R,0,34,21,11,e+7-1,t-45-16-2,21,11);for(var i=t-45+1;i<t-45+1+45-1;i++)for(var r=e+1;r<e+1+a-2;r++)S[i*d+r]=30}(),function(){for(var e=0,t=0,a=0,i=0,r=0;r<Q.length;r++){var n=Q[r].x*y,l=Q[r].y*T;F.fillStyle="#eeeeee";var s=22,o=8;switch(F.fillStyle=m[Q[r].type-3],Q[r].type==k&&(o=3),Q[r].orientation){case 0:t=(e=n+4)+s,a=l+T-o,i=l+T;break;case 2:e=n+y-o,t=n+y,i=(a=l+4)+s;break;case 1:t=(e=n)+o,i=(a=l+4)+s;break;case 3:t=(e=n+4)+s,i=(a=l)+o}if(F.fillRect(e,a,t-e,i-a),Q[r].type!=k)for(var h=a;h<i;h++)for(var f=e;f<t;f++)S[h*d+f]=10+Q[r].type;switch(s=30,o=2,F.fillStyle=c[Q[r].type-3],Q[r].orientation){case 0:t=(e=n)+s,a=l+T-o,i=l+T;break;case 3:t=(e=n)+s,i=(a=l)+o;break;case 1:t=(e=n)+o,i=(a=l)+s;break;case 2:e=n+y-o,t=n+y,i=(a=l)+s}F.fillRect(e,a,t-e,i-a)}}(),function(){for(var e=0;e<C.length;e++)for(var t=Math.floor(C[e].y)*d+Math.floor(C[e].x),a=0;a<C[e].height;a++)for(var i=0;i<C[e].width;i++)S[t+a*d+i]=50+e;for(oe(),F.fillStyle="#eeeeee",e=0;e<C.length;e++)F.fillRect(C[e].x,C[e].y,C[e].width,C[e].height)}(),1==Y.state){for(var i,r=t;30<r;)le(30),r-=30;0<r&&le(r),!1!==Y.onEmitter&&0<(i=C[Y.onEmitter]).sY&&(Y.y=i.y-u+Y.bounds[1])}he(!1);var n=10;for(Y.inDash&&(n=2);n<t;)$(e,n),t-=n;0<t&&$(e,t),function(e){for(var t=q.length-1;0<=t;t--){var a=q[t][0],i=q[t][1];8==j[i][a]&&280<e-q[t][2]?(q[t][2]=e,j[i][a]=0):0==j[i][a]&&1120<e-q[t][2]&&(j[i][a]=b,q.splice(t,1))}}(e),function(){if(w)for(var e=0;e<I.length;e++){var t=I[e],a=t.baseFrame+t.currentFrame,i=Math.floor(t.x)+Math.floor(t.y)*d;t.touchingExit=!1;for(var r=0;r<u;r++)for(var n=0;n<u;n++){var l=4*(a*u+n+r*w.width),s=i+n+r*d;0==w.data[l]&&0==w.data[l+1]&&0==w.data[l+2]||0==w.data[l+3]||(S[s]===x&&(t.state=0,t.stateTimer=0,playSound(2)),30==S[s]&&Y.tileBelow&&(t.touchingExit=1))}if(Math.floor(t.x),Math.floor(t.y),F.drawImage(R,a*u,0,u,u,Math.floor(t.x)*U,Math.floor(t.y)*U,u*U,u*U),1==t.actorType&&Y.inDash){for(var o=.6,h=V.length-2;0<=h&&(F.globalAlpha=o,F.drawImage(R,a*u,0,u,u,Math.floor(V[h][0])*U,Math.floor(V[h][1])*U,u*U,u*U),!((o-=.07)<=0));h-=2);F.globalAlpha=1}}}()}}};t.init(),function e(){t.update(),requestAnimationFrame(e)}();
    </script>




  </body>
</html>  